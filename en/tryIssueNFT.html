<!DOCTYPE html>
<html lang="en">
<head>
  <title>Crypto C14 One stop blockchain DApp</title>
  <meta charset="utf-8">
  <meta name="description" content="Crypto C14 One stop blockchain DApp">
  <meta name="keywords" content="blockchain, crypto evidence, digital evidence, DAPP, anti-counterfeiting, traceability, NFT, reward points">
  <meta name="author" content="wechat ID: fengyun_houston">
  <meta name="wallet" content="ARDOR-49CE-CXZZ-3QHW-AH4JK">
  <meta name="integrity" content="token...">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel = "icon" href ="../images/icon-ditinow.png" type = "image/x-icon">
  <link rel="stylesheet" href="../css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/style-cc14.css">
  <link rel="stylesheet" href="../css/jquery.dataTables.min.css">
  <style>
  @media all and (min-width: 992px) {
	  .navbar .nav-item .dropdown-menu{ display: none; }
    .navbar .nav-item:hover .nav-link{ color: #000;  }
	  .navbar .nav-item:hover .dropdown-menu{ display: block; }
	  .navbar .nav-item .dropdown-menu{ margin-top:0; }
  }
</style>
</head>
<body>
  <div style="min-height: calc(100vh - 50px);">
    <nav class="navbar sticky-top navbar-expand-lg navbar-light bg-light shadow" id="navbar">
      <div class="container-fluid">
        <a class="navbar-brand" href="../../index.html"><img src="../images/logo-cc14.png" width="74" height="44" loading="lazy"></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <!-- load by src='js/nav_footer.js' -->
        </div>
      </div>
    </nav>
    <div class="container-fluid"><!-- container ============================ -->
      <div class="row" name="actionBlock"><!-- actionBlock ==================-->
        <div class="col-12 col-sm-10 mx-auto">
          <div class="accordion"><br>

            <div class="accordion-item" name="Issue anti-counterfeiting product">
              <h2 class="accordion-header" id="issueNFTflip">
                <button id="issueNFTbtn" class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#issueNFTpanel" aria-expanded="false" aria-controls="issueNFTpanel" >
                  <h4>&#x1F430; Issue title token (NFT)</h4>
                </button>
              </h2>
              <div id="issueNFTpanel" class="accordion-collapse collapse show" aria-labelledby="issueNFTflip" >
                <div class="accordion-body">
                  <div id="issueNFTFormAction">
                    <form id="issueNFTForm2">
                      <div class="input-group mb-3" >
                        <span class="input-group-text" >Barcode</span>
                        <input type="number" class="form-control" name='barcode' list="barcodeList" min="10000000" max="9999999999999" placeholder="8 to 14 digits barcode" required>
                        <datalist id="barcodeList">
                          <option value="6901234567890">CC14 Collapsible Umbrella, Sky 43-inch</option>
                          <option value="6903456789012">CC14 logo polo shirts, set of two</option>
                          <option value="6902345678901">Green tea</option>
                        </datalist>
                      </div>
                      <div class="input-group mb-3 d-none" >
                        <span class="input-group-text">Description</span>
                        <input type="text" class="form-control" placeholder="text ..." name='description' maxlength="500"  >
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Message</span>
                        <input type="text" class="form-control" name='message' maxlength="500" placeholder="optional ..."  >
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Passphrase</span>
                        <input type="password" class="form-control" name='secretPhrase' id="issueNFTPassword" value="ci di wu yin 300 liang ge bi wang er bu ceng tou">
                        <span class="input-group-text fs-4"  id="issueNFTPasswordIcon" onclick="togglePasswordFn('issueNFTPassword')">&#128584;</span>
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Quantity</span>
                        <input type="number" class="form-control" name='issueQty' value='5' min="1" max="99">
                      </div>
                      <div class="input-group justify-content-end mb-3">
                        <input type="reset" class="btn btn-outline-secondary" value="&#x1F503;Reset">
                        <input type="submit" class="btn btn-outline-secondary " id="requestDTbtn" value="&#x2705;Prepare transactionBytes">
                      </div>
                    </form>
                    <form id="issueNFTBroadcastForm">
                      <input type="hidden" name="requestType" value="broadcastTransaction">
                      <input type="hidden" name="transactionBytes" value="">
                      <input type="submit" id="issueNFTBroadcastBtn" class="btn btn-success btn-lg" style="width:100%" value="&#x2714; Confirm broadcast">
                    </form>
                  </div>
                  <div class="col-12 col-sm-12 d-none" id="issueNFTResponse">
                    <div class="overflow-auto" name="issueNFTResult">
                        <h5>Summary:</h5>
                        <span>Save to <button id="table2excel" class="btn btn-outline-secondary btn-sm">&#x1F4E5; spreadsheet</button>. Transaction fee are paid in CC14.</span><br>
                      <div class="table-responsive">
                        <table class="table table-sm text-nowrap fs-6 table-bordered border-info caption-top" id="issueNFTResultTbl">
                          <thead class="thead-light">
                            <tr>
                              <th>NFT ID (short)</th>
                              <th>Product ID</th>
                              <th>Verification Code</th>
                              <th>Full hash (long NFT ID)</th>
                              <th>Barcode</th>
                              <th>Asset name</th>
                              <th>Mssage</th>
                              <th>Issuer wallet</th>
                              <th>Issuance time</th>
                              <th>fee</th>
                            </tr>
                          </thead>
                          <tbody id="myTable">
                          </tbody>
                        </table>
                      </div>
                      <div class="justify-content-center overflow-auto" id="issueNFTQRCode" style="max-height:320px"></div>
                    </div>
                    <div class="text-wrap text-break overflow-auto" style="max-height:800px">
                      <h5>JSON response</h5>
                      <span id="issueNFTJSON"></span>
                    </div>
                  </div>
                </div><!-- accordion-item panel body end =================== -->
              </div><!-- accordion-item panel end ========================== -->
            </div><!-- accordion-item end ================================== -->

            <div class="accordion-item" name="Issue anti-counterfeiting product with predefined serial number">
              <h2 class="accordion-header" id="issueNFTwSNoflip">
                <button id="issueNFTwSNobtn" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#issueNFTwSNopanel" aria-expanded="false" aria-controls="issueNFTwSNopanel" >
                  <h4>&#128220; Issue title token with pre-defined serial number</h4>
                </button>
              </h2>
              <div id="issueNFTwSNopanel" class="accordion-collapse collapse" aria-labelledby="issueNFTwSNoflip" >
                <div class="accordion-body">
                  <div id="issueNFTwSNoFormAction">
                    <form id="issueNFTwSNoForm">
                      <div class="input-group mb-3" >
                        <span class="input-group-text" >Barcode</span>
                        <input type="number" class="form-control" name='barcode' list="barcodeList" min="10000000" max="9999999999999" value="6902345678901">
                        <datalist id="barcodeList">
                          <option value="6901234567890">CC14 Collapsible Umbrella, Sky 43-inch</option>
                          <option value="6903456789012">CC14 logo polo shirts, set of two</option>
                          <option value="6902345678901">Green tea</option>
                        </datalist>
                      </div>
                      <div class="input-group mb-3 " >
                        <span class="input-group-text">Serial No.</span>
                        <textarea class="form-control" placeholder="['SN0001', 'SN0002', 'SN0003']" name='serialNo'>["SN0001", "SN0002", "SN0003"]</textarea>
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Message</span>
                        <input type="text" class="form-control" name='message' maxlength="500" placeholder="optional ..."  >
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Passphrase</span>
                        <input type="password" class="form-control" name='secretPhrase' id='issueNFTwSNoPassword' value="ci di wu yin 300 liang ge bi wang er bu ceng tou">
                        <span class="input-group-text fs-4"  id="issueNFTwSNoPasswordIcon" onclick="togglePasswordFn('issueNFTwSNoPassword')">&#128584;</span>
                      </div>
                      <div class="input-group mb-3 d-none" >
                        <span class="input-group-text">Quantity</span>
                        <input type="number" class="form-control" name='issueQty' list="issueNFTList1" min="2" max="100">
                        <datalist id="issueNFTList1">
                          <option value="2">Quantity 2</option>
                          <option value="5">Quantity 5</option>
                          <option value="10">Quantity 10</option>
                        </datalist>
                      </div>
                      <div class="input-group justify-content-end mb-3">
                        <input type="reset" class="btn btn-outline-secondary" value="&#x1F503;Reset">
                        <input type="submit" class="btn btn-outline-secondary " id="requestDTbtn" value="&#x2705;Prepare transactionBytes">
                      </div>
                    </form>
                    <form id="issueNFTwSNoBroadcastForm">
                      <input type="hidden" name="requestType" value="broadcastTransaction">
                      <input type="hidden" name="transactionBytes" value="">
                      <input type="submit" id="issueNFTwSNoBroadcastBtn" class="btn btn-success btn-lg" style="width:100%" value="&#x2714; Confirm broadcast">
                    </form>
                  </div>
                  <div class="col-12 col-sm-12 d-none" id="issueNFTwSNoResponse">
                    <div class="overflow-auto" name="issueNFTwSNoResult">
                        <h5>Summary:</h5>
                        <span>Save to <button id="table2excelwSNo" class="btn btn-outline-secondary btn-sm">&#x1F4E5; spreadsheet</button>. Transaction fee are paid in CC14.</span><br>
                        <!-- <span><br><b>Note: </b>in order to maintain minimum  blance in demonstration account, <input type="button" class="btn btn-success btn-sm" disabled value="&#x2714;Confirm broadcast"> will be disabled if issue more than 2 title tokens.</span> -->
                      <div class="table-responsive">
                        <table class="table table-sm text-nowrap fs-6 table-bordered border-info caption-top" id="issueNFTwSNoResultTbl">
                          <thead class="thead-light">
                            <tr>
                              <th>#</th>
                              <th>Title Token ID</th>
                              <th>Product ID</th>
                              <th>Verification Code</th>
                              <th>Full hash</th>
                              <th>Barcode</th>
                              <th>Asset name</th>
                              <th>Mssage</th>
                              <th>Issuer wallet</th>
                              <th>Issuance time</th>
                              <th>fee</th>
                            </tr>
                          </thead>
                          <tbody id="issueNFTwSNoTable">
                          </tbody>
                        </table>
                      </div>
                      <div class="justify-content-center overflow-auto" id="issueNFTwSNoQRCode" style="max-height:320px"></div>
                    </div>
                    <div class="text-wrap text-break overflow-auto" style="max-height:800px">
                      <h5>JSON response</h5>
                      <span id="issueNFTwSNoJSON"></span>
                    </div>
                  </div>
                </div><!-- accordion-item panel body end =================== -->
              </div><!-- accordion-item panel end ========================== -->
            </div><!-- accordion-item end ================================== -->

            <div class="accordion-item" name="Issue fungiable token">
              <h2 class="accordion-header" id="issueAssetFlip">
                <button id="issueAssetbtn" class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#issueAssetPanel" aria-expanded="false" aria-controls="issueAssetPanel" >
                  <h4 style="opacity:0.3;">&#x1F426; Issue fungible token</h4>
                </button>
              </h2>
              <div id="issueAssetPanel" class="accordion-collapse collapse" aria-labelledby="issueAssetFlip" style="opacity:0.3;">
                <div class="accordion-body">
                  <div class="col-12 col-sm-12 mb-3">
                    <form id="issueAssetForm">
                      <div class="input-group mb-3">
                        <span class="input-group-text" >Quantity</span>
                        <input type="text" class="form-control" name="quantity" value="1234.500">
                        <span class="input-group-text" >decimals</span>
                        <input type="text" class="form-control" name="decimals" value="3" >
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text" >Barcode</span>
                        <input type="text" class="form-control" name='barcode' list="barcodeList2" maxlength="14" value="9876123456789">
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Description</span>
                        <input type="text" class="form-control" value='{"unit":"kg", "lotNo":"GX-45678"}' name='description' maxlength="500" >
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Message</span>
                        <input type="text" class="form-control" name='message' maxlength="500" placeholder="optional ...">
                      </div>
                      <div class="input-group mb-3" >
                        <span class="input-group-text">Passphrase</span>
                        <input type="password" class="form-control" name='secretPhrase' id='issueAssetPassword' value="ci di wu yin 301 liang ge bi wang er bu ceng tou">
                        <span class="input-group-text fs-4"  id="issueAssetPasswordIcon" onclick="togglePasswordFn('issueAssetPassword')">&#128584;</span>
                      </div>
                      <div class="input-group justify-content-end mb-3">
                        <input type="reset" class="btn btn-outline-secondary" value="&#x1F503;Reset" disabled>
                        <input type="submit" class="btn btn-outline-secondary " id="requestDTbtn" value="&#x2705;Prepear transactionBytes" disabled>
                      </div>
                    </form>
                    <div>
                      <form id="issueAssetBroadcastTransactionForm">
                        <input type="text" id="issueAssetTransactionBytes" class="form-control mb-3" name="transactionBytes" placeholder="autocomplete by DApp...">
                        <input type="button" id="issueAssetBroadcastBtn" class="btn btn-success btn-lg" style="width:100%"  value="&#x2714; Boradcast transactionBytes" onClick="broadcastTransactionFn('issueAsset')" disabled>
                      </form>
                    </div>
                  </div>
                  <div class="d-none" id="issueAssetDisplay">
                    <div overflow-auto>
                      <h5>Summary:</h5>
                      <span id="issueAssetBroadcastTransactionResult"></span>
                      <div id="issueAssetResult"></div>
                      <div class="justify-content-center overflow-auto" id="issueAssetQRCode" style="max-height:320px"></div>
                    </div>
                    <div class="text-wrap text-break overflow-auto" style="max-height:640px">
                      <span id="issueAssetJSON"><h5>JSON response</h5></span>
                    </div>
                  </div>
                </div><!-- accordion-item panel body end =================== -->
              </div><!-- accordion-item panel end ========================== -->
            </div><!-- accordion-item end ================================== -->

          </div><!-- accordion end ========================================= -->
        </div>
      </div><!-- actionBlock end ============================================-->
    </div><!-- container end =============================================== -->
  </div><!-- 100% vh end =================================================== -->
  <footer id="footer" style="height: 50px;">
    <!-- load by nav_footer.js -->
  </footer>
</body>
<script>
  var isNode = false;
</script>
<script src='../js/3rdparty/jquery-3.5.1.min.js'></script>
<script src='../js/3rdparty/bootstrap.bundle.min.js' ></script>
<script src="../js/3rdparty/easy.qrcode.js"  charset="utf-8"></script>
<script src="../js/3rdparty/crypto-js.min.js"></script>
<script src="../js/3rdparty/jsbn.js"></script>
<script src="../js/3rdparty/jsbn2.js"></script>
<script src="../js/3rdparty/extensions.js"></script>
<script src="../js/3rdparty/converters.js"></script>
<script src="../js/3rdparty/nrs.util.js"></script>
<script src="../js/3rdparty/jquery.table2excel.js"></script>
<script src="../js/3rdparty/filter.js"></script>
<script src="../js/3rdparty/jquery.dataTables.min.js" ></script>
<script src='../data/conf.js' ></script>
<script src='../data/doNotShare.js' ></script>
<script src='../data/myAddressBook.js' ></script>
<script src='../data/myAssetBook.js' ></script>
<script src='scripts-cc14.js' ></script>
<script src='nav_footer.js' ></script>

<script>
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {return new bootstrap.Tooltip(tooltipTriggerEl)});
  $("#navbarSupportedContent").html(navbarSupportedContentHtml);
  $("#footer").html(footerHtml);
  $("input[type='text']").on("click", function () {$(this).select();});
</script>
<script>
$("#issueNFTForm2").submit(function(event){
  event.preventDefault();
  sessionStorage.clear();
  var formData = $(this).serializeArray();
  console.log(formData);
  var issueQty=parseInt(formData[4].value);
  if(issueQty >20 && (formData[3].value)==secretPhraseIssuance){
    $("#issueNFTBroadcastBtn").prop('disabled', true);
  };
  var barcode   = parseInt(formData[0].value);
  var assetName = barcode.toString(32);
  var fullHashArray         = new Array(issueQty);
  var assetIDArray          = new Array(issueQty);
  var transactionBytesArray = new Array(issueQty);

  for(i=0; i<issueQty;i++){
    var placeholder=99999-i;
    var issueAssetData = [
      {name:"requestType", value:"issueAsset"},
      {name:"name",        value:assetName},
      {name:"description", value:"NFTID"+placeholder},
      {name:"quantityQNT", value:"1"},
      {name:"decimals",    value:"0"},
      {name:"secretPhrase",value:formData[3].value},
      {name:"feeNQT",      value:"0"},
      {name:"deadline",    value:"60"},
      {name:"broadcast",   value:"false"},
      {name:"message",     value:formData[2].value+i},
    ];
    $.ajax({
      type:"POST",
      url: apiNodeURL,
      data:issueAssetData,
      success:function(response){
        var responseObj = JSON.parse(response);
        fullHashArray[i]         = responseObj.fullHash;
        transactionBytesArray[i] = responseObj.transactionBytes;
        assetIDArray[i]          = NRS.fullHashToId(fullHashArray[i]);
        var feeCC14     = responseObj.transactionJSON.feeNQT/100000000;
        var timestamp   = responseObj.transactionJSON.timestamp;
        var senderRS    = responseObj.transactionJSON.senderRS;
        var description = responseObj.transactionJSON.attachment.description;
        var message     = responseObj.transactionJSON.attachment.message;
        var key         = CryptoJS.enc.Hex.parse(keyHex);
        var iv          = CryptoJS.enc.Hex.parse(ivHex);
        var encryptedID = CryptoJS.AES.encrypt(assetIDArray[i], key, { iv: iv });
        var regCodeText = encryptedID.ciphertext.toString();
        var issueTime   = timestampToLocalFn(timestamp);
        var issueNFTTbl = "<tr><td>&#160;"+assetIDArray[i] +
                          "</td><td>&#160;"+assetIDArray[i]+
                          "</td><td>"+regCodeText+
                          "</td><td>"+fullHashArray[i]+
                          "</td><td>&#160;"+barcode+
                          "</td><td>"+assetName+
                          "</td><td>"+message+
                          "</td><td>"+senderRS+
                          "</td><td>"+issueTime[0]+" "+issueTime[1]+
                          "</td><td>"+feeCC14+
                          "</td></tr>";
        // console.log(description.substring(0,5));
        $("#issueNFTResultTbl tbody").append(issueNFTTbl);
        $("#issueNFTJSON").after("<h6>issueAsset - NFT#"+"</h6><textarea class='form-control border border-info' rows='10'>" + JSON.stringify(responseObj,undefined, 4)+"</textarea>");
      }
    });
  };


  // var i=0;
  // issueNFTFn();
  // function issueNFTFn(){
  //   if(i<issueQty){
  //     $.ajax({
  //       type:"POST",
  //       url: apiNodeURL,
  //       data:issueAssetData,
  //       success:function(response){
  //         var responseObj = JSON.parse(response);
  //         fullHashArray[i]         = responseObj.fullHash;
  //         transactionBytesArray[i] = responseObj.transactionBytes;
  //         assetIDArray[i]          = NRS.fullHashToId(fullHashArray[i]);
  //         var feeCC14     = responseObj.transactionJSON.feeNQT/100000000;
  //         var timestamp   = responseObj.transactionJSON.timestamp;
  //         var senderRS    = responseObj.transactionJSON.senderRS;
  //         var description = responseObj.transactionJSON.attachment.description;
  //         var message     = responseObj.transactionJSON.attachment.message;
  //         var key         = CryptoJS.enc.Hex.parse(keyHex);
  //         var iv          = CryptoJS.enc.Hex.parse(ivHex);
  //         var encryptedID = CryptoJS.AES.encrypt(assetIDArray[i], key, { iv: iv });
  //         var regCodeText = encryptedID.ciphertext.toString();
  //
  //         var issueTime   = timestampToLocalFn(timestamp);
  //         var n = i+1;
  //         var issueNFTTbl = "<tr><td>"+n+
  //                           "</td><td>&#160;"+assetIDArray[i] +
  //                           "</td><td>&#160;"+assetIDArray[i]+
  //                           "</td><td>"+regCodeText+
  //                           "</td><td>"+fullHashArray[i]+
  //                           "</td><td>&#160;"+barcode+
  //                           "</td><td>"+assetName+
  //                           "</td><td>"+message+
  //                           "</td><td>"+senderRS+
  //                           "</td><td>"+issueTime[0]+" "+issueTime[1]+
  //                           "</td><td>"+feeCC14+
  //                           "</td></tr>";
  //         if(i==0){
  //           issueNFTQRCodeFn(assetIDArray[i],regCodeText,"issueNFTQRCode");
  //           $("#issueNFTResultTbl tbody").append(issueNFTTbl);
  //           $("#issueNFTJSON").after("<h6>issueAsset - NFT#"+n+"</h6><textarea class='form-control border border-info' rows='10'>" + JSON.stringify(responseObj,undefined, 4)+"</textarea>");
  //           i++;
  //           issueNFTFn();
  //         }else if (assetIDArray[i] != assetIDArray[i-1]) {
  //           issueNFTQRCodeFn(assetIDArray[i],regCodeText,"issueNFTQRCode");
  //           $("#issueNFTResultTbl tbody").append(issueNFTTbl);
  //           $("#issueNFTJSON").after("<h6>issueAsset - NFT#"+n+"</h6><textarea class='form-control border border-info' rows='10'>" + JSON.stringify(responseObj,undefined, 4)+"</textarea>");
  //           sessionStorage.setItem("issueNFTBroadcast", JSON.stringify(transactionBytesArray));
  //           i++;
  //           issueNFTFn();
  //         }else if (assetIDArray[i] == assetIDArray[i-1]) {
  //           setTimeout(function() {
  //             issueNFTFn();
  //           }, 1000);
  //         };
  //       }
  //     });
  //   };
  // };
  $("#issueNFTResponse").removeClass("d-none");
});
</script>
</html>
